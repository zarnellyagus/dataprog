<div class="consolidate-policy-page">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="row align-items-center">
      <div class="col">
        <h2 class="page-title mb-1">Consolidate Policy</h2>
        <p class="text-muted mb-0">Kelola & cari data consolidate policy dengan pagination</p>
      </div>
      <div class="col-auto">
        <div class="d-flex gap-2">
          <button class="btn btn-outline-primary btn-sm" (click)="onReset()">
            <i class="fas fa-refresh me-1"></i> Reset Filter
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Form -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="row g-3">
        <!-- Policy ID Search -->
        <div class="col-md-4 col-sm-6">
          <label for="policyId" class="form-label fw-medium">Policy ID</label>
          <input 
            type="text" 
            class="form-control" 
            id="policyId"
            formControlName="policyId"
            placeholder="POLICY-000001"
            [class.is-valid]="searchForm.get('policyId')?.value && !isLoading">
          <div class="form-text">Cari berdasarkan Policy ID</div>
        </div>

        <!-- App No Search -->
        <div class="col-md-4 col-sm-6">
          <label for="appNo" class="form-label fw-medium">Application No</label>
          <input 
            type="text" 
            class="form-control" 
            id="appNo"
            formControlName="appNo"
            placeholder="APP-00000001"
            [class.is-valid]="searchForm.get('appNo')?.value && !isLoading">
          <div class="form-text">Cari berdasarkan App Number</div>
        </div>

        <!-- Action Buttons -->
        <div class="col-md-4 col-sm-12 d-flex align-items-end gap-2">
          <button 
            type="submit" 
            class="btn btn-primary flex-grow-1"
            [disabled]="isLoading">
            <i class="fas fa-search me-1"></i>
            {{ isLoading ? 'Searching...' : 'Cari Data' }}
          </button>
          <button 
            type="button" 
            class="btn btn-outline-secondary"
            (click)="onReset()"
            [disabled]="isLoading">
            <i class="fas fa-refresh me-1"></i> Reset
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Data Table Card -->
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
          <i class="fas fa-file-alt me-2 text-primary"></i>
          Data Policy ({{totalCount | number}} records)
        </h5>
        
        <!-- Page Size Selector -->
        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 fw-medium small text-muted">Show:</label>
          <select 
            class="form-select form-select-sm" 
            style="width: 80px;"
            [(ngModel)]="pageSize" 
            (ngModelChange)="onPageSizeChange()"
            [disabled]="isLoading">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card-body p-0">
      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="p-5 text-center">
        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted">Memuat data policy...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && policies.length === 0" class="p-5 text-center">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">Tidak ada data policy</h5>
        <p class="text-muted">Coba ubah filter pencarian atau klik tombol reset</p>
        <button class="btn btn-outline-primary" (click)="onReset()">Reset Filter</button>
      </div>

      <!-- Data Table -->
      <div class="table-responsive" *ngIf="!isLoading && policies.length > 0">
        <table class="table table-hover mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <th scope="col" class="border-top-0">Company ID</th>
              <th scope="col" class="border-top-0">Policy ID</th>
              <th scope="col" class="border-top-0">App No</th>
              <th scope="col" class="border-top-0">Owner Name</th>
              <th scope="col" class="border-top-0">Issued Date</th>
              <th scope="col" class="border-top-0 text-center" style="width: 120px;">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let policy of policies; trackBy: trackByPolicyId">
              <td><span class="badge bg-light text-dark">{{policy.companyID}}</span></td>
              <td>
                <a href="#" 
                   class="text-decoration-none fw-semibold text-primary"
                   (click)="viewPolicyDetail(policy.policyID); $event.preventDefault()">
                  {{policy.policyID}}
                </a>
              </td>
              <td>{{policy.appNo}}</td>
              <td class="text-truncate" style="max-width: 200px;" title="{{policy.ownerName}}">
                {{policy.ownerName}}
              </td>
              <td>{{formatDate(policy.issuedDate)}}</td>
              <td class="text-center">
                <button 
                  class="btn btn-sm btn-outline-primary"
                  (click)="viewPolicyDetail(policy.policyID)"
                  title="Lihat detail">
                  <i class="fas fa-eye"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination - ✅ FIXED PAGE NUMBERS SHOW -->
    <div class="card-footer bg-light py-3" *ngIf="totalCount > pageSize">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <!-- Info -->
        <div class="small text-muted">
          Menampilkan {{((currentPage - 1) * pageSize) + 1}} - 
          {{(currentPage * pageSize > totalCount ? totalCount : currentPage * pageSize)}} 
          dari {{totalCount | number}} total records
        </div>

        <!-- Pagination Controls -->
        <nav aria-label="Policy pagination">
          <ul class="pagination pagination-sm mb-0">
            <!-- Previous Button -->
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage - 1)"
                [attr.aria-label]="'Previous'">
                <i class="fas fa-chevron-left me-1"></i>Sebelumnya
              </button>
            </li>

            <!-- ✅ PAGE NUMBERS - SHOWS 1 2 3 4 5 -->
            <li 
              *ngFor="let page of getPageNumbers(); let isFirst = first; let isLast = last"
              class="page-item" 
              [class.active]="page === currentPage">
              <button 
                class="page-link {{isFirst ? 'rounded-start' : ''}} {{isLast ? 'rounded-end' : ''}}" 
                (click)="goToPage(page)">
                {{page}}
              </button>
            </li>

            <!-- Next Button -->
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage + 1)"
                [attr.aria-label]="'Next'">
                Selanjutnya<i class="fas fa-chevron-right ms-1"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Debug Info (REMOVE PRODUCTION) -->
      <div class="mt-2 p-2 bg-light-subtle border rounded small">
        <strong>Debug:</strong> 
        current={{currentPage}} totalPages={{totalPages}} | 
        pageNumbers={{getPageNumbers() | json}} | 
        records={{policies.length}}
      </div>
    </div>
  </div>
</div>
